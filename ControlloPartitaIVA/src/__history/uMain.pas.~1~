unit uMain;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Soap.InvokeRegistry, System.Net.URLClient, Vcl.StdCtrls, Soap.Rio,
  Soap.SOAPHTTPClient;

type
  TForm1 = class(TForm)
    HTTPRIO1: THTTPRIO;
    btnVerify: TButton;
    Memo1: TMemo;
    gbDaVerificare: TGroupBox;
    edtPIVAVer: TEdit;
    Label2: TLabel;
    edtNazVer: TEdit;
    Label1: TLabel;
    gbRichiedente: TGroupBox;
    Label3: TLabel;
    Label4: TLabel;
    edtPIVARic: TEdit;
    edtNazRic: TEdit;
    procedure btnVerifyClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

uses checkVatService;

procedure TForm1.btnVerifyClick(Sender: TObject);
var
  lParam: checkVatApprox;
  lResponse: checkVatApproxResponse;
begin
  lParam := checkVatApprox.Create;
  lParam.countryCode := edtNazVer.Text;
  lParam.vatNumber := edtPIVAVer.Text;
  lParam.requesterCountryCode := edtNazRic.Text;
  lParam.requesterVatNumber := edtPIVARic.Text;
  lResponse := (HTTPRIO1 as checkVatPortType).checkVatApprox(lParam);
  Memo1.Lines.Clear;
  if not lResponse.valid then
  begin
    Memo1.Lines.Add('Partita IVA non valida');
  end
  else
  begin
    Memo1.Lines.Add('Data di richiesta: ' + DateToStr(lResponse.requestDate.AsDate));
    Memo1.Lines.Add('Nazione: ' + lResponse.countryCode);
    Memo1.Lines.Add('Identificativo fiscale: ' + lResponse.vatNumber);
    Memo1.Lines.Add('Ragione Sociale: ' + lResponse.traderName);
    Memo1.Lines.Add('Indirizzo: ' + lREsponse.traderAddress);
    Memo1.Lines.Add(lResponse.traderStreet);
    Memo1.Lines.Add(lResponse.traderPostcode);
    Memo1.Lines.Add(lResponse.traderCity);
    Memo1.Lines.Add(lResponse.traderCompanyType);
  end;
end;

end.
